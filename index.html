<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Phosphor Decay Mobile - An Instrument of Tautological Singularity</title>
    <meta name="description" content="Where observation and creation collapse into the same eternal instant, and the echo becomes the source.">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:,">
</head>

<body>
    <div id="app">
        <div id="error-log"
            style="display:none; background:rgba(255,0,0,0.8); color:white; padding:10px; position:fixed; top:0; left:0; right:0; z-index:9999; font-family:monospace; white-space:pre-wrap;">
        </div>
        <script>
            window.onerror = function (msg, url, lineNo, columnNo, error) {
                const errorLog = document.getElementById('error-log');
                errorLog.style.display = 'block';
                errorLog.textContent += `Error: ${msg}\nAt: ${url}:${lineNo}:${columnNo}\nStack: ${error ? error.stack : 'N/A'}\n\n`;
                return false;
            };
            window.addEventListener('unhandledrejection', function (event) {
                const errorLog = document.getElementById('error-log');
                errorLog.style.display = 'block';
                errorLog.textContent += `Unhandled Rejection: ${event.reason}\n\n`;
            });
        </script>

        <header>
            <h1>VIDEO_SYNTH_V1</h1>
            <div class="header-controls">
                <button id="start-btn">INITIALIZE_SYSTEM</button>
                <button id="mobile-menu-btn" class="mobile-menu-btn" title="Controls">‚ãÆ</button>
                <button id="toggle-ui-btn" title="Hide UI & Cursor">üëÅ</button>
            </div>
        </header>

        <!-- Mobile Controls Dropdown -->
        <div id="mobile-controls-panel" class="mobile-controls-panel">
            <div class="mobile-controls-header">
                <h2>CONTROLS</h2>
                <button id="close-mobile-menu" class="close-mobile-menu">‚úï</button>
            </div>
            <div class="mobile-controls-content">
                <!-- Left Sidebar: Video & Shape Controls -->
                <div class="controls left-controls" id="left-controls">
                    <h2>VIDEO/SHAPES</h2>
                    <div class="control-group">
                        <h3>VIDEO_INPUT</h3>
                        <button id="cam-btn">WEBCAM</button>
                    </div>
                    <!-- Dynamic controls will be injected here -->
                </div>

                <!-- Right Sidebar: Audio Controls -->
                <div class="controls right-controls" id="right-controls">
                    <h2>AUDIO</h2>
                    <div class="control-group">
                        <h3>AUDIO_ENGINE</h3>
                        <label>VOLUME <input type="range" id="master-vol" min="-60" max="0" value="-10"></label>
                    </div>
                    <!-- Dynamic audio controls will be injected here -->
                </div>
            </div>
        </div>

        <main>
            <!-- Center: Canvas (full screen on mobile) -->
            <div class="canvas-container" id="canvas-container">
                <canvas id="main-canvas"></canvas>
                <div class="overlay">NO_SIGNAL</div>
                <button class="fullscreen-btn" id="fullscreen-btn">‚õ∂</button>
                <button class="canvas-feedback-btn active" id="canvas-feedback-btn"
                    title="Restart Feedback Loop">‚àû</button>
                <button class="timebased-btn" id="timebased-btn" title="Time-Based Composer">‚ô©</button>
            </div>
        </main>
    </div>

    <!-- Tone.js from CDN -->
    <script src="https://unpkg.com/tone@14.8.49/build/Tone.js"></script>
    <script>
        if (window.Tone) {
            console.log('Tone.js loaded successfully');
        } else {
            console.error('Tone.js failed to load');
        }
    </script>
    <script type="module" src="src/main.js?v=6"></script>
</body>

</html>